<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Eats - Order Confirmed</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- HEADER -->
  <header>
    <h1>AI Eats</h1>
    <nav>
      <div class="nav-left">
        <a href="login.html" id="auth-link">Login/Register</a>
      </div>
      <div class="nav-center">
        <a href="index.html">Home</a>
        <a href="menu.html">Menu</a>
        <a href="chat.html">AI Chat</a>
      </div>
      <div class="nav-right">
        <a href="cart.html"> Cart (<span id="cart-count">0</span>)</a>
      </div>
    </nav>
  </header>

  <!-- CONFIRMATION SECTION -->
  <section class="confirmation-section">
    <div class="confirmation-container">
      <!-- Success Header -->
      <div class="success-header">
        <div class="success-icon">[CONGRATS]</div>
        <h1>Order confirmed!</h1>
        <p class="success-message">Your order has been placed successfully</p>
      </div>

      <!-- Order Summary Card -->
      <div class="order-summary-card">
        <div class="order-header">
          <h3>Order #<span id="order-id"></span></h3>
          <span class="order-status">Confirmed</span>
        </div>
        
        <div class="delivery-info">
          <div class="delivery-time">
            <span class="label">Estimated delivery</span>
            <span class="time" id="delivery-time"></span>
          </div>
        </div>

        <div class="order-items">
          <div id="confirmation-items"></div>
        </div>

        <div class="order-total">
          <span>Total</span>
          <span id="order-total"></span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="confirmation-actions">
        <a href="menu.html" class="btn-primary">Order again</a>
        <a href="index.html" class="btn-secondary">Back to home</a>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 AI Eats. All rights reserved.</p>
  </footer>

  <script>
    const API_URL = "http://127.0.0.1:5000";

    function loadOrderConfirmation() {
      const orderData = JSON.parse(localStorage.getItem("lastOrder"));
      
      if (!orderData) {
        window.location.href = "index.html";
        return;
      }
      
      document.getElementById("order-id").textContent = orderData.orderId;
      document.getElementById("order-total").textContent = orderData.total;
      
      const deliveryTime = new Date();
      deliveryTime.setMinutes(deliveryTime.getMinutes() + 35);
      document.getElementById("delivery-time").textContent = deliveryTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      const itemsContainer = document.getElementById("confirmation-items");
      orderData.items.forEach(item => {
        itemsContainer.innerHTML += `
          <div class="item-row">
            <div class="item-details">
              <span class="item-name">${item.name}</span>
              <span class="item-qty">Qty: ${item.quantity}</span>
            </div>
            <span class="item-price">$${(item.price * item.quantity).toFixed(2)}</span>
          </div>
        `;
      });
      
      localStorage.removeItem("lastOrder");
    }

    function updateCartCount() {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById("cart-count").textContent = totalItems;
    }

    function updateAuthStatus() {
      const isLoggedIn = localStorage.getItem("isLoggedIn");
      const username = localStorage.getItem("username");
      const isVIP = localStorage.getItem("isVIP") === "true";
      const authLink = document.getElementById("auth-link");
      
      if (isLoggedIn === "true" && username) {
        const vipIcon = isVIP ? "[VIP] " : "";
        authLink.textContent = `[USER] ${vipIcon}${username}`;
        authLink.href = "profile.html";
      } else {
        authLink.textContent = "Login/Register";
        authLink.href = "login.html";
      }
    }

    loadOrderConfirmation();
    updateCartCount();
    updateAuthStatus();
  </script>
</body>
</html>