<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Eats - Menu</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- HEADER -->
  <header>
    <h1>AI Eats</h1>

    <nav>
      <div class="nav-left">
        <a href="login.html" id="auth-link">Login/Register</a>
      </div>

      <div class="nav-center">
        <a href="index.html">Home</a>
        <a href="menu.html">Menu</a>
        <a href="chat.html">AI Chat</a>
      </div>

      <div class="nav-right">
        <a href="cart.html">üõí Cart (<span id="cart-count">0</span>)</a>
      </div>
    </nav>
  </header>

  <!-- MENU SECTION -->
  <section class="menu">
    <h2>Our Menu</h2>
    <div class="menu-grid" id="menu-grid">
    </div>
        <h3>Salmon Sushi</h3>
        <p>Fresh salmon with perfectly seasoned rice.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <span class="rating-text">4.9 (189 reviews)</span>
        </div>
        <span class="price">$14.99</span>
        <button class="add-to-cart" onclick="addToCart('Salmon Sushi')">Add to Cart</button>
      </div>

      <div class="menu-card">
        <img src="images/pasta.jpeg" alt="Fettuccine Alfredo">
        <h3>Fettuccine Alfredo</h3>
        <p>Creamy pasta with parmesan cheese and herbs.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span>
          <span class="rating-text">4.7 (156 reviews)</span>
        </div>
        <span class="price">$12.99</span>
        <button class="add-to-cart" onclick="addToCart('Fettuccine Alfredo')">Add to Cart</button>
      </div>

      <div class="menu-card">
        <img src="images/spaghetti_bolognese.jpeg" alt="Spaghetti Bolognese">
        <h3>Spaghetti Bolognese</h3>
        <p>Classic Italian pasta with meat sauce.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span>
          <span class="rating-text">4.6 (203 reviews)</span>
        </div>
        <span class="price">$12.99</span>
        <button class="add-to-cart" onclick="addToCart('Spaghetti Bolognese')">Add to Cart</button>
      </div>

      <div class="menu-card">
        <img src="images/salad.jpeg" alt="Grilled Chicken Salad">
        <h3>Grilled Chicken Salad</h3>
        <p>Fresh greens with chicken and dressing.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <span class="rating-text">4.7 (145 reviews)</span>
        </div>
        <span class="price">$10.99</span>
        <button class="add-to-cart" onclick="addToCart('Grilled Chicken Salad')">Add to Cart</button>
      </div>

      <div class="menu-card">
        <img src="images/margherita_pizza.jpeg" alt="Margherita Pizza">
        <h3>Margherita Pizza</h3>
        <p>Tomatoes, mozzarella, and fresh basil.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <span class="rating-text">4.8 (267 reviews)</span>
        </div>
        <span class="price">$14.99</span>
        <button class="add-to-cart" onclick="addToCart('Margherita Pizza')">Add to Cart</button>
      </div>

      <div class="menu-card">
        <img src="images/chicken_parmesan.jpeg" alt="Chicken Parmesan">
        <h3>Chicken Parmesan</h3>
        <p>Breaded chicken topped with marinara and cheese.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <span class="rating-text">4.9 (178 reviews)</span>
        </div>
        <span class="price">$15.99</span>
        <button class="add-to-cart" onclick="addToCart('Chicken Parmesan')">Add to Cart</button>
      </div>

      <div class="menu-card">
        <img src="images/penne_alla_vodka.jpeg" alt="Penne alla Vodka">
        <h3>Penne alla Vodka</h3>
        <p>Pasta in a creamy tomato-vodka sauce.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span>
          <span class="rating-text">4.5 (134 reviews)</span>
        </div>
        <span class="price">$13.99</span>
        <button class="add-to-cart" onclick="addToCart('Penne alla Vodka')">Add to Cart</button>
      </div>

      <div class="menu-card">
        <img src="images/chicken_wings.jpeg" alt="Chicken Wings">
        <h3>Chicken Wings</h3>
        <p>Spicy and crispy chicken wings with dipping sauce.</p>
        <div class="dish-rating">
          <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <span class="rating-text">4.7 (298 reviews)</span>
        </div>
        <span class="price">$11.99</span>
        <button class="add-to-cart" onclick="addToCart('Chicken Wings')">Add to Cart</button>
      </div>

    </div>
  </section>

  <!-- VIP MENU SECTION -->
  <section class="vip-menu-section" id="vip-menu-section">
    <h2>VIP Exclusive Menu</h2>
    <div id="vip-menu-content">
      <div class="menu-grid">
        <div class="menu-card">
          <img src="images/lobster.jpeg" alt="Grilled Lobster">
          <h3>Grilled Lobster</h3>
          <p>Succulent lobster grilled to perfection.</p>
          <div class="dish-rating">
            <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
            <span class="rating-text">4.9 (87 reviews)</span>
          </div>
          <span class="vip-badge">VIP</span>
          <span class="price">$35.99</span>
          <button class="add-to-cart" onclick="addToCart('Grilled Lobster')">Add to Cart</button>
        </div>

        <div class="menu-card">
          <img src="images/ribeye.jpeg" alt="Ribeye Steak">
          <h3>Ribeye Steak</h3>
          <p>Juicy ribeye steak, perfectly seared.</p>
          <div class="dish-rating">
            <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
            <span class="rating-text">4.8 (112 reviews)</span>
          </div>
          <span class="vip-badge">VIP</span>
          <span class="price">$29.99</span>
          <button class="add-to-cart" onclick="addToCart('Ribeye Steak')">Add to Cart</button>
        </div>

        <div class="menu-card">
          <img src="images/tomahawk.jpeg" alt="Tomahawk Steak">
          <h3>Tomahawk Steak</h3>
          <p>Premium tomahawk cut with rich marbling.</p>
          <div class="dish-rating">
            <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
            <span class="rating-text">5.0 (43 reviews)</span>
          </div>
          <span class="vip-badge">VIP</span>
          <span class="price">$49.99</span>
          <button class="add-to-cart" onclick="addToCart('Tomahawk Steak')">Add to Cart</button>
        </div>
      </div>
    </div>
    
    <div id="vip-menu-locked" class="vip-locked" style="display: none;">
      <div class="lock-icon">üîí</div>
      <h3>VIP Members Only</h3>
      <p>Unlock exclusive premium dishes with VIP membership</p>
      <a href="vip-membership.html" class="btn vip-upgrade-btn">Upgrade to VIP - $9.99/month</a>
    </div>
  </section>

  <footer>
    &copy; 2025 AI Eats. All rights reserved.
  </footer>

  <script>
    const API_URL = "http://127.0.0.1:5000";
    let menuItems = {};

    async function loadMenu() {
      try {
        const response = await fetch(`${API_URL}/api/menu/`);
        const dishes = await response.json();
        
        const menuGrid = document.getElementById("menu-grid");
        menuGrid.innerHTML = "";
        
        dishes.forEach(dish => {
          menuItems[dish.name] = {
            id: dish.id,
            name: dish.name,
            price: dish.price,
            description: dish.description,
            image: dish.image_url || 'images/default.jpeg',
            vipOnly: false,
            rating: dish.average_rating,
            ratingCount: dish.rating_count
          };
          
          const stars = generateStars(dish.average_rating);
          const menuCard = document.createElement("div");
          menuCard.className = "menu-card";
          menuCard.innerHTML = `
            <img src="${dish.image_url || 'images/default.jpeg'}" alt="${dish.name}">
            <h3>${dish.name}</h3>
            <p>${dish.description}</p>
            <div class="dish-rating">
              <span class="stars">${stars}</span>
              <span class="rating-text">${dish.average_rating.toFixed(1)} (${dish.rating_count} reviews)</span>
            </div>
            <span class="price">$${dish.price.toFixed(2)}</span>
            <button class="add-to-cart" onclick="addToCart('${dish.name}')">Add to Cart</button>
          `;
          menuGrid.appendChild(menuCard);
        });
      } catch (error) {
        console.error("Error loading menu:", error);
        document.getElementById("menu-grid").innerHTML = "<p>Error loading menu. Please try again later.</p>";
      }
    }

    function generateStars(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      let stars = "‚≠ê".repeat(fullStars);
      if (hasHalfStar && fullStars < 5) stars += "‚òÜ";
      return stars;
    }

    function addToCart(itemName) {
      const item = menuItems[itemName];
      const isVIP = localStorage.getItem("isVIP") === "true";
      
      if (item.vipOnly && !isVIP) {
        alert("This item is exclusive to VIP members!\n\nUpgrade to VIP membership to access premium dishes.");
        return;
      }
      
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      
      const existingItem = cart.find(cartItem => cartItem.name === itemName);
      
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          ...item,
          quantity: 1
        });
      }
      
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'Added!';
      btn.style.backgroundColor = '#4CAF50';
      
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.backgroundColor = '';
      }, 1000);
    }

    function updateCartCount() {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById("cart-count").textContent = totalItems;
    }

    function updateAuthStatus() {
      const isLoggedIn = localStorage.getItem("isLoggedIn");
      const username = localStorage.getItem("username");
      const isVIP = localStorage.getItem("isVIP") === "true";
      const authLink = document.getElementById("auth-link");
      
      if (isLoggedIn === "true" && username) {
        const vipIcon = isVIP ? "üëë " : "";
        authLink.textContent = `üë§ ${vipIcon}${username}`;
        authLink.href = "profile.html";
      } else {
        authLink.textContent = "Login/Register";
        authLink.href = "login.html";
      }
    }

    function checkVIPMenuAccess() {
      const isVIP = localStorage.getItem("isVIP") === "true";
      const vipMenuContent = document.getElementById("vip-menu-content");
      const vipMenuLocked = document.getElementById("vip-menu-locked");
      
      if (isVIP) {
        vipMenuContent.style.display = "block";
        vipMenuLocked.style.display = "none";
      } else {
        vipMenuContent.style.display = "none";
        vipMenuLocked.style.display = "block";
      }
    }

    updateCartCount();
    updateAuthStatus();
    checkVIPMenuAccess();
    loadMenu();
  </script>

</body>
</html>
